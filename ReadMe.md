# Polyglot Microservices Architecture with Event-Driven Design & RabbitMQ (WordWeave)

## Overview

This repository demonstrates a **polyglot microservices architecture** designed for scalability, flexibility, and decoupling. Each service is built using different technology stacks and databases, communicating asynchronously via **RabbitMQ events** and synchronously via **gRPC**.

### Key Features

- **Fully Decoupled Services**  
  Each microservice owns its own database and schema with no shared foreign key constraints. Services communicate through asynchronous events and synchronous gRPC calls.

- **Event-Driven Architecture with RabbitMQ**  
  Services publish and subscribe to domain events for eventual consistency and loose coupling.

- **Polyglot Stack**  
  Different services leverage the best tools for their purpose:

  - User Service: Node.js + MongoDB
  - Post Service: Go + PostgreSQL
  - Like Service: Rust + SurrealDB + RocksDB
  - Media Service: Python + ImageKit
  - Comment Service: .NET + MySQL
  - Event Service: Ruby + PostgreSQL + RabbitMQ + Redis (Event store and Dead Letter Queue)
  - Frontend: React + Vite
  - API Gateway: Single unified entrypoint (port 8080)

- **Centralized Event Service**  
  Acts as the core event publisher, consumer, event store, and dead letter queue handler.

- **Dockerized for Easy Local Development**  
  All services run in isolated Docker containers orchestrated by Docker Compose.

---

## Getting Started

### Prerequisites

- Docker (version 28.x+ recommended)
- Docker Compose (v2+)
- `ngrok` (for exposing local webhook server externally, optional)
- `curl` or Postman (for testing APIs)
- Internet connection for pulling images

### Environment Variables

Each service has its own `.env` file defining relevant configs like DB URLs, ports, RabbitMQ URLs, gRPC endpoints, API keys, etc.

Example `.env` variables for **User Service**:

```env
MONGO_URI=mongodb://mongo:27017/users
GRPC_PORT=50051
WEBHOOK_PORT=8081
SVIX_SECRET=your_svix_secret
NGROK_AUTH_TOKEN=your_ngrok_token
```

Make sure to set appropriate environment variables for all services before running.

---

## Running the System

Use Docker Compose to build and run all services:

```bash
docker-compose up -d --build
```

This will:

- Build images for all microservices
- Create containers and networks
- Start RabbitMQ, Redis, databases, API Gateway, and all microservices
- Services will connect to RabbitMQ and each other as configured

To rebuild and force recreate a specific service (e.g. like-service):

```bash
docker-compose up -d --no-deps --build --force-recreate like-service
```

---

## Webhook Setup (User Service)

1. Start the User Service container (webhook listens on port 8081).
2. Run `ngrok` to expose webhook externally:

```bash
ngrok http http://localhost:8081/
```

3. Copy the HTTPS URL generated by ngrok.
4. Configure this URL as a webhook endpoint in your Clerk dashboard under user events.
5. The User Service will update MongoDB based on webhook event callbacks.

---

## Event Service Components

- **Event Publisher:** Publishes events to RabbitMQ exchanges/topics
- **Event Consumer:** Subscribes to relevant queues, processes events, and forwards them
- **Event Store:** (PostgreSQL) stores event history for auditing and replay
- **Dead Letter Queue Handler:** Handles failed events for retries or manual inspection
- **Redis Cache:** Optional, for caching event metadata or state
- **gRPC API:** For event replay, querying, and administration

---

## Authorization & Cross-Service Validation

- **Authentication** is handled at the API Gateway level (e.g., token validation).
- **Authorization and data validation** (e.g., user exists before creating post/comment) are done via synchronous gRPC calls between services.
- Events reflect eventual consistency and state changes, not immediate validation.

---

## Useful Docker Commands

- **List running containers:**

  ```bash
  docker ps
  ```

- **Inspect container details:**

  ```bash
  docker inspect <container_name_or_id>
  ```

- **Get container IP address:**

  ```bash
  docker inspect <container_name> | grep IPAddress
  ```

- **View container logs:**

  ```bash
  docker logs -f <container_name>
  ```

- **Enter running container shell:**

  ```bash
  docker exec -it <container_name> sh
  # or bash if available
  docker exec -it <container_name> bash
  ```

- **Stop containers:**

  ```bash
  docker-compose down
  ```

---

## Architecture Diagram (Simplified)

```plaintext
+--------------+       +-------------+       +---------------+   +---------------+
|  User        |       |  Post       |       |  Like         |   |    Comment    |
|  (Node+Mongo)| <---> |  (Go+PG)    | <---> | (Rust+Surreal)|   |  (.Net+MySQL) |
+--------------+       +-------------+       +---------------+   +---------------+
       |                    |                       |                    |
       +--------------------+-----------------------+--------------------+
                                        |
                                RabbitMQ (Event Bus)
                                        |
                    +-------------------------------------+
                    |             Event Service           |
                    | (Ruby + RabbitMQ + PG + DLQ + Redis)|
                    +-------------------------------------+
                                        |
                                    API Gateway
                                        |
                                Frontend (React)
```

---

## Notes

- All services have **independent databases**, no shared schema or foreign keys.
- Services use **gRPC** for direct communication (internal RPC calls).
- All cross-service state changes are propagated via **RabbitMQ events**.
- Event-driven approach ensures eventual consistency and high decoupling.
- Using **Docker Compose** allows for easy local development and testing.
- Webhook setup with `svix` and `ngrok` enables external event triggers in local environments.
- Use logs and `docker exec` for debugging inside containers.

---

## Contributing

Contributions and improvements are welcome! Please fork the repo and submit a pull request.

---

## License

MIT License

---

---

# Contact

For questions or support, please open an issue or contact the maintainer.
